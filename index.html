<!DOCTYPE html>

<html>
	
	<head>
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<h1>superCannonBall</h1>
		<script src="lib/matter.js"></script>
		<script>
			let engine = Matter.Engine.create();

			let render = Matter.Render.create({
			    element: document.body,
			    engine:engine,
			    options: {
			    	width: 1600,
			    	height: 1000,
			    	wireframes: false
			    }
			});

			let ground = Matter.Bodies.rectangle(1200, 500, 500, 50, { isStatic: true });
			let stack = Matter.Composites.stack(1100, 50, 6, 30, 0, 0, function(x, y){
				return Matter.Bodies.rectangle(x, y, 15, 15);
			});


			let mouse = Matter.Mouse.create(render.canvas);
			let mouseConstraint = Matter.MouseConstraint.create(engine, {
				mouse: mouse,
				constraint: {
					render: {visible: true}
				}
			});

			let ball = Matter.Bodies.circle(300, 600, 40);
			let sling = Matter.Constraint.create({
				pointA: {x:300, y: 600},
				bodyB: ball,
				stiffness: 0.05

			});
			render.mouse = mouse;

			let fire = false;
			Matter.Events.on(mouseConstraint, 'enddrag', function(e){
				if(e.body === ball) fire = true;
			});

			Matter.Events.on(engine, 'afterUpdate', function(){
				if (fire && Math.abs(ball.position.x-300)<20 && Math.abs(ball.position.y-600)<20) {
					ball = Matter.Bodies.circle(300, 600, 40);
					Matter.World.add(engine.world, ball);
					sling.bodyB = ball;
					fire = false;
				}
			});

			Matter.World.add(engine.world, [sling, ball, stack, ground, mouseConstraint]);
			Matter.Engine.run(engine);
			Matter.Render.run(render);
		</script>
	</body>
 
</html>
